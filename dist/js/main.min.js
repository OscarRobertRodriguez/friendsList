!function(){function e(e){e.target;if("updateInfo"===e.target.getAttribute("class")){e.preventDefault();var n=e.target.parentNode,i=n.firstChild.firstChild.nextSibling.value.trim(),o=n.firstChild.nextSibling.firstChild.nextSibling.value.trim(),r=n.firstChild.nextSibling.nextSibling.firstChild.nextSibling.value.trim(),s=+n.parentNode.parentNode.previousSibling.getAttribute("data-key");if(""==i&&""==o&&""==r&&console.log("nothing updated"),""!==i||""!==o||""!==r){console.log("something was updated");var d=l.transaction("friends","readwrite").objectStore("friends"),c=d.get(s);c.onsuccess=function(e){var n=c.result;""!==i&&(n.name=i),""!==r&&(n.phone=r),""!==o&&(n.email=o);var u=d.put(n,s);u.onsuccess=function(){var e=(u.result,l.transaction("friends","readonly").objectStore("friends")),n=e.getAll();n.onsuccess=function(){var e=n.result;console.log("info updated"),a(e),t()}}}}}}function t(){0===document.querySelector(".list").children.length&&console.log("You need some friends delete the indexedDB database")}function n(e){var t=(document.getElementById("myModal"),document.getElementsByClassName("modal")),n=e.target.getAttribute("class");"modal"!==n&&"close"!==n||([].forEach.call(t,function(e){e.style.display="none"}),console.log("edit box closed"))}function i(e){if("edit_text"===e.target.getAttribute("class")){var t=e.target,n=t.parentNode.previousSibling.previousSibling.previousSibling.firstChild.nextSibling.textContent;t.parentNode.parentNode.nextSibling.style.display="block",console.log("Editor for "+n+" opened")}}function o(e){if("delete_X"===e.target.getAttribute("class")){var t=e.target,n=t.parentNode.parentNode,i=t.parentNode.nextSibling.nextSibling.firstChild.nextSibling.textContent,o=t.parentNode.nextSibling.firstChild.nextSibling.textContent,a=l.transaction("friends","readwrite").objectStore("friends"),r=a.index("email"),s=r.openCursor(IDBKeyRange.only(i.toString()));console.log("Deleted "+o),n.parentNode.removeChild(n),s.onsuccess=function(){var e=s.result;e&&(e.delete(),e.continue())},s.onerror=function(){console.log("error",s.result.errorCode),console.log("failed to delete "+o)}}}function a(e){var n=document.querySelector(".list");n.innerHTML="";for(var i=[],o=0,a=1;a<=e.length;a++)i[o++]='<div class="twelve columns list-item" data-key="'+e[a-1].id+'">',i[o++]='<div class="delete">',i[o++]='<a class="delete_X">X</a>',i[o++]="</div>",i[o++]='<h5>Name:<span class="list-info">'+e[a-1].name+"</span></h5>",i[o++]='<h5>Email:<span class="list-info">'+e[a-1].email+"</span></h5>",i[o++]='<h5>Phone:<span class="list-info phone-marker">'+e[a-1].phone+"</span></h5>",i[o++]='<div class="edit">',i[o++]='<a class="edit_text">edit</a>',i[o++]="</div>",i[o++]="</div>",i[o++]='<div id="myModal" class="modal">',i[o++]='<div class="modal-content">',i[o++]='<span class="close">&times;</span>',i[o++]="<h1>Edit Info</h1>",i[o++]='<form class="edit-form">',i[o++]='<label class="formLabel">Name:<input class="formInput"></label>',i[o++]='<label class="formLabel">Email:<input class="formInput"></label>',i[o++]='<label class="formLabel">Phone:<input class="formInput"></label>',i[o++]='<button type="submit" class="updateInfo">Update</button>',i[o++]="</form>",i[o++]="</div>",i[o++]="</div>";n.innerHTML+=i.join(""),t()}var l;document.getElementsByClassName("delete_X");if("indexedDB"in window){var r=window.indexedDB.open("testDB",1);r.onerror=function(e){console.log("Error"+e.taget.errorCode)},r.onupgradeneeded=function(e){console.log("upgrading");var t=e.target.result;if(!t.objectStoreNames.contains("friends")){console.log("creating friends objectStore");var n=t.createObjectStore("friends",{autoIncrement:!0});n.createIndex("email","email",{unique:!0}),n.createIndex("id","id",{unique:!0})}n.transaction.oncomplete=function(e){var n=t.transaction("friends","readwrite").objectStore("friends");[{id:1,email:"bob@bob.com",name:"Bob",phone:5126806168},{id:2,email:"dan@dan.com",name:"Dan",phone:5123456789},{id:3,email:"sarah@gmail.com",name:"Sarah",phone:5123454589},{id:4,email:"oscar@gmail.com",name:"Oscar",phone:512234589},{id:5,email:"johnny@gmail.com",name:"Johnny",phone:5123454512}].forEach(function(e){console.log("added friend"),n.put(e)})}},r.onsuccess=function(t){l=t.target.result;var s=r.result.transaction("friends","readonly").objectStore("friends"),d=s.getAll();d.onsuccess=function(e){return a(d.result)};var c=document.querySelector(".list");c.addEventListener("click",o,!1),c.addEventListener("click",i,!1),c.addEventListener("click",e,!1),c.addEventListener("click",n)}}}();